---
import { getCollection } from "astro:content";
import PageLayout from "../layouts/PageLayout.astro";
import ArrowCard from "../components/ArrowCard.astro";
import PhotoGalleryGrid from "../components/PhotoGalleryGrid.astro";
import { SITE, SOCIALS } from "../consts";
import { Image } from "astro:assets";

// Import images for optimized twin buttons
import coffeeBg from "../assets/coffee-bg.jpg";
import aboutBg from "../assets/about-bg.png";

// 1. Fetch collections with DRAFT filter
const allPosts = await getCollection("articles", ({ data }) => {
  return data.draft !== true; 
});

const allPhotos = await getCollection("photos", ({ data }) => {
  return !('draft' in data && data.draft === true); 
});

// 2. Sort by Date (and other criteria)
const blog = allPosts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 5);

const featuredPhotos = allPhotos
  .sort((a, b) => {
    const weightA = a.data.weight ?? Infinity;
    const weightB = b.data.weight ?? Infinity;
    if (weightA !== weightB) return weightA - weightB;

    const dateA = a.data.date ? new Date(a.data.date).getTime() : 0;
    const dateB = b.data.date ? new Date(b.data.date).getTime() : 0;
    if (dateA !== dateB) return dateB - dateA;

    return a.data.title.localeCompare(b.data.title);
  })
  .slice(0, 9);
---

<PageLayout title="home" description={SITE.DESCRIPTION}>
  <div class="container-narrow">
    
 <section class="animate mt-4 mb-20">
      <div class="grid grid-cols-1 md:grid-cols-12 gap-8 items-center">
        
        <div class="md:col-span-7 space-y-6">
          <h1 class="text-3xl md:text-4xl font-serif text-black/80 dark:text-white/80 leading-tight">
            Photography, coffee and a whole lot more 
          </h1>
          <div class="flex items-center gap-3">
            <div class="h-px w-8 bg-black/20 dark:bg-white/20"></div>
            <p class="text-xs uppercase tracking-[0.3em] text-neutral-400 font-medium">
              By Ken
            </p>
          </div>
        </div>

{/* w-[250px] change for the desktop image size, mobile image is hidden */}
<div class="hidden md:flex md:col-span-5 md:justify-end bg-transparent">
 <div class="relative group w-[250px] aspect-square overflow-hidden rounded-2xl p-2">
    <img 
      src="/hero.png" 
      alt="Hero image" 
      class="w-full h-full rounded-xl object-cover grayscale hover:grayscale-0 transition-all duration-700"
    />
  </div>
</div>

      </div>
    </section>

    <section class="animate space-y-6 mb-16">
      <div class="flex flex-wrap items-center justify-between gap-y-2">
        <h2 class="text-sm font-semibold uppercase tracking-widest text-black/30 dark:text-white/30">
          Featured Albums
        </h2>
        <a href="/photos" class="group flex items-center gap-1 text-xs font-medium transition-colors hover:text-black dark:hover:text-white text-neutral-500">
          <span>View all photos</span>
          <span class="transition-transform group-hover:translate-x-1">→</span>
        </a>
      </div>
      
      <PhotoGalleryGrid photos={featuredPhotos} />
    </section>

    <section class="animate space-y-6">
      <div class="flex flex-wrap items-center justify-between gap-y-2">
        <h2 class="text-sm font-semibold uppercase tracking-widest text-black/30 dark:text-white/30">
          Latest posts
        </h2>
        <a href="/articles" class="group flex items-center gap-1 text-xs font-medium transition-colors hover:text-black dark:hover:text-white text-neutral-500">
          <span>View all posts</span>
          <span class="transition-transform group-hover:translate-x-1">→</span>
        </a>
      </div>
      <ul class="flex flex-col gap-4">
        {blog.length > 0 ? (
          blog.map((post) => (
            <li>
              <ArrowCard entry={post} />
            </li>
          ))
        ) : (
          <p class="text-sm text-neutral-500">No posts found.</p>
        )}
      </ul>
    </section>
  </div>
  
  <div class="max-w-4xl mx-auto px-6">
    <section class="animate grid grid-cols-1 sm:grid-cols-2 gap-4 mt-10 mb-20">
      
      <a href="/coffee-log" class="group relative h-32 rounded-xl overflow-hidden bg-stone-100 dark:bg-neutral-900 border border-black/5 dark:border-white/5 transition-all hover:border-black/20 dark:hover:border-white/20">
        <Image 
          src={coffeeBg} 
          alt="Coffee log background" 
          class="absolute inset-0 w-full h-full object-cover opacity-10 dark:opacity-20 grayscale group-hover:grayscale-0 group-hover:opacity-30 transition-all duration-700"
        />
        <div class="absolute inset-0 flex items-center justify-center">
          <div class="flex flex-col items-center">
            <span class="text-[10px] uppercase tracking-[0.4em] text-black/30 dark:text-white/30 mb-2">Database</span>
            <span class="text-lg font-medium tracking-[0.2em] uppercase text-black dark:text-white">
              Coffee Log
            </span>
          </div>
        </div>
      </a>

      <a href="/about" class="group relative h-32 rounded-xl overflow-hidden bg-stone-100 dark:bg-neutral-900 border border-black/5 dark:border-white/5 transition-all hover:border-black/20 dark:hover:border-white/20">
        <Image 
          src={aboutBg} 
          alt="About page background" 
          class="absolute inset-0 w-full h-full object-cover opacity-10 dark:opacity-20 grayscale group-hover:grayscale-0 group-hover:opacity-30 transition-all duration-700"
        />
        <div class="absolute inset-0 flex items-center justify-center">
          <div class="flex flex-col items-center">
            <span class="text-[10px] uppercase tracking-[0.4em] text-black/30 dark:text-white/30 mb-2">Information</span>
            <span class="text-lg font-medium tracking-[0.2em] uppercase text-black dark:text-white">
              About
            </span>
          </div>
        </div>
      </a>

    </section>
  </div>
</PageLayout>