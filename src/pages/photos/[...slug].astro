---
import Layout from "../../layouts/PageLayout.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const photos = await getCollection("photos");
  // Only build pages for internal galleries
  return photos
    .filter(p => p.data.type === "internal")
    .map((p) => ({
      params: { slug: p.slug },
      props: { photoEntry: p },
    }));
}

const { photoEntry } = Astro.props;
// This is the modern way to get the Markdown content
const { Content } = await photoEntry.render();
---

<Layout title={photoEntry.data.title}>
  <main class="max-w-4xl mx-auto px-6 py-12">
    <div class="mb-8">
      <a href="/photos" class="text-sm font-medium opacity-50 hover:opacity-100 transition-opacity flex items-center gap-2">
        <span>‚Üê</span> Back to Galleries
      </a>
    </div>
    
    <article>
      <header class="mb-12">
        <h1 class="text-5xl font-bold tracking-tight">{photoEntry.data.title}</h1>
        {photoEntry.data.description && (
          <p class="text-xl mt-4 text-neutral-500 dark:text-neutral-400">
            {photoEntry.data.description}
          </p>
        )}
      </header>

      <div class="rounded-3xl overflow-hidden border border-black/5 dark:border-white/5 shadow-2xl">
        <Image 
          src={photoEntry.data.thumbnail} 
          alt={photoEntry.data.title}
          width={1200}
          height={800}
          class="w-full h-auto object-cover"
        />
      </div>

      <div class="mt-16 prose prose-neutral dark:prose-invert prose-lg max-w-none">
        <Content />
      </div>
    </article>
  </main>
</Layout>