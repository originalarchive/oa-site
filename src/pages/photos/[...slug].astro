---
import { getCollection } from "astro:content";
import PhotoAlbumLayout from "../../layouts/PhotoAlbumLayout.astro";

// 1. You must import all these components here
import JournalGallery from "@components/JournalGallery.astro";
import SideBySide from "@components/SideBySide.astro";
import LegoGrid from "@components/LegoGrid.astro";
import Caption from "@components/Caption.astro";

export async function getStaticPaths() {
  const photos = await getCollection("photos");
  
  return photos
    .filter(p => p.data.type === "internal")
    .map((p) => {
      const cleanSlug = p.slug.split('/')[0];
      return {
        params: { slug: cleanSlug },
        props: { photoEntry: p },
      };
    });
}

const { photoEntry } = Astro.props;
const { Content } = await photoEntry.render();

// 2. Define the components mapping object inside the code fence
const components = {
  JournalGallery,
  SideBySide,
  LegoGrid,
  Caption
};
---

<PhotoAlbumLayout frontmatter={photoEntry.data}>
  {/* 3. Pass the components object to Content here */}
  <Content components={components} />
</PhotoAlbumLayout>