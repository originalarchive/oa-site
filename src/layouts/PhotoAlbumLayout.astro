---
import PageLayout from "./PageLayout.astro";
const { frontmatter } = Astro.props;
---

<PageLayout title={frontmatter.title} description={frontmatter.description}>
  {/* The pt-32 clears your fixed navigation bar once and for all */}
  <div class="max-w-4xl mx-auto px-6 pt-4 pb-12">
    
    <nav class="mb-8">
      <a href="/photos" class="text-[14px] font-mono uppercase tracking-[0.3em] text-neutral-500 hover:text-white transition-colors">
        <span class="mr-2">â€¹</span> BACK TO ALBUMS
      </a>
    </nav>
    
    <div class="album-wrapper">
      <div id="photo-content" class="prose prose-neutral dark:prose-invert max-w-none">
        <slot />
      </div>

      <div id="photo-grid" class="columns-1 md:columns-2 gap-8 space-y-8 mt-4">
        {/* Images will be moved here by the script */}
      </div>
    </div>
  </div>
</PageLayout>

<style is:global>
  /* 1. HIDE AUTOMATIC H1 */
  #photo-content h1 { 
    display: none !important; 
  }

  /* 2. STYLE YOUR ## TITLE */
  #photo-content h2 {
    @apply text-5xl md:text-4xl font-bold tracking-tight text-white uppercase mb-8;
    display: block !important;
  }

  /* 3. DESCRIPTION STYLE */
  #photo-content p {
    @apply text-xl leading-relaxed font-serif text-neutral-400 mb-8;
  }

  /* 4. MASONRY LOGIC & CLEANUP */
  #photo-content img { display: none !important; }
  
  /* Collapses empty paragraphs left behind after moving images */
  #photo-content p:empty { display: none; }

  #photo-grid img {
    @apply rounded-sm w-full h-auto cursor-zoom-in transition-opacity duration-500 hover:opacity-80;
    display: block;
    break-inside: avoid;
    margin-bottom: 2rem;
  }
</style>

<script>
  function initGallery() {
    const content = document.getElementById('photo-content');
    const grid = document.getElementById('photo-grid');

    if (!content || !grid) return;

    // Select images that haven't been moved yet
    const images = content.querySelectorAll('img');
    
    images.forEach((img) => {
      // Ensure the image is visible before moving it to the grid
      img.style.display = 'block';
      grid.appendChild(img);
    });
  }

  // This ensures the gallery re-runs when navigating back and forth
  document.addEventListener('astro:page-load', initGallery);
</script>