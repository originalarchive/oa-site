---
// src/components/CldImage.astro
interface Props {
  publicId: string;
  alt: string;
  width?: number;
  height?: number;
  class?: string;
  isLCP?: boolean;
}

const { 
  publicId, 
  alt, 
  width = 800, 
  height, 
  class: className,
  isLCP = false 
} = Astro.props;

const cloudName = "dtjrlrbky"; // Ensure this matches your account

const baseUrl = `https://res.cloudinary.com/${cloudName}/image/upload`;
const transformations = `f_auto,q_auto,w_${width}${height ? `,h_${height},c_fill` : ''}`;
const src = `${baseUrl}/${transformations}/${publicId}`;
---

{/* Comment moved outside or wrapped in braces to avoid the "Property 'If' does not exist" build error.
  isLCP handles:
  - loading="eager" (Download NOW)
  - fetchpriority="high" (Top of the queue)
  - decoding="sync" (Draw to screen immediately)
*/}
<img 
  src={src} 
  alt={alt} 
  width={width} 
  height={height} 
  class:list={["scale 101% block w-full h-auto m-0 p-0", className]}
  loading={isLCP ? "eager" : "lazy"}
  fetchpriority={isLCP ? "high" : "auto"}
  decoding={isLCP ? "sync" : "async"}
/>