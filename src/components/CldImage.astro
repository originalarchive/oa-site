---
// src/components/CldImage.astro
interface Props {
  publicId: string;
  alt: string;
  width?: number;
  height?: number;
  class?: string;
  isLCP?: boolean; // New prop to handle PageSpeed LCP warnings
}

const { 
  publicId, 
  alt, 
  width = 800, 
  height, 
  class: className,
  isLCP = false 
} = Astro.props;

// Replace with your actual Cloudinary Cloud Name
const cloudName = "your-cloud-name";

// Construct the transformation URL
// f_auto,q_auto are essential for the performance scores you saw
const baseUrl = `https://res.cloudinary.com/${cloudName}/image/upload`;
const transformations = `f_auto,q_auto,w_${width}${height ? `,h_${height},c_fill` : ''}`;
const src = `${baseUrl}/${transformations}/${publicId}`;
---

<img 
  src={src} 
  alt={alt} 
  width={width} 
  height={height} 
  class={className}
  /* If it's the LCP image: 
     - loading="eager" tells the browser to download it NOW.
     - fetchpriority="high" gives it priority over other assets.
     - decoding="sync" ensures it draws to screen as fast as possible.
  */
  loading={isLCP ? "eager" : "lazy"}
  fetchpriority={isLCP ? "high" : "auto"}
  decoding={isLCP ? "sync" : "async"}
/>