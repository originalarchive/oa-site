---
import type { CollectionEntry } from "astro:content";

interface Props {
  coffeeEntries: CollectionEntry<"coffee">[];
}

const { coffeeEntries = [] } = Astro.props;
---

<div class="flex flex-col gap-4">
  {coffeeEntries.map((entry: CollectionEntry<"coffee">) => (
    <details 
      class="coffee-card group border border-black/10 dark:border-white/10 rounded-xl overflow-hidden bg-black/[0.02] dark:bg-white/[0.02]"
      data-date={entry.data.dateBrewed.toISOString()}
    >
      <summary class="list-none cursor-pointer p-4 flex items-center justify-between hover:bg-black/5 dark:hover:bg-white/5 transition-colors">
        <div class="flex flex-col gap-1">
          <div class="flex items-center gap-2">
            <span class="font-bold text-black dark:text-white text-lg leading-tight">
              {entry.data.name}
            </span>
            <span class="text-[10px] px-2 py-0.5 rounded-full bg-black/10 dark:bg-white/20 font-mono font-bold">
              {entry.data.rating.overall}
            </span>
          </div>
          <div class="flex items-center gap-2 text-sm opacity-60">
            <span>{entry.data.roaster}</span>
            <span>•</span>
            <span>{entry.data.origin}</span>
          </div>
        </div>

        <div class="flex items-center gap-6">
          <div class="hidden md:flex flex-col items-end text-xs">
            <span class="font-medium opacity-80">{entry.data.brewMethod}</span>
            <span class="opacity-50">{entry.data.dateBrewed.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' })}</span>
          </div>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-40 group-open:rotate-180 transition-transform duration-300">
            <path d="m6 9 6 6 6-6"/>
          </svg>
        </div>
      </summary>

      <div class="p-4 pt-0 border-t border-black/5 dark:border-white/5 bg-white/30 dark:bg-black/10">
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 py-6">
          {entry.data.brewMethod && (
            <div>
              <p class="text-[10px] uppercase tracking-widest opacity-50 font-bold mb-1">Method</p>
              <p class="text-sm">{entry.data.brewMethod}</p>
            </div>
          )}
          {entry.data.grindSize && (
            <div>
              <p class="text-[10px] uppercase tracking-widest opacity-50 font-bold mb-1">Grind Size</p>
              <p class="text-sm">{entry.data.grindSize}</p>
            </div>
          )}
          {entry.data.waterTemp && (
            <div>
              <p class="text-[10px] uppercase tracking-widest opacity-50 font-bold mb-1">Temp</p>
              <p class="text-sm">{entry.data.waterTemp}</p>
            </div>
          )}
          {entry.data.process && (
            <div>
              <p class="text-[10px] uppercase tracking-widest opacity-50 font-bold mb-1">Process</p>
              <p class="text-sm">{entry.data.process}</p>
            </div>
          )}
          {entry.data.variety && (
            <div>
              <p class="text-[10px] uppercase tracking-widest opacity-50 font-bold mb-1">Variety</p>
              <p class="text-sm">{entry.data.variety}</p>
            </div>
          )}
        </div>

        <div class="flex gap-6 pb-6 border-b border-black/5 dark:border-white/5">
           <div class="flex flex-col">
             <span class="text-[10px] uppercase opacity-50 font-bold">Flavor</span>
             <span class="font-mono text-sm">{"★".repeat(entry.data.rating.flavor)}{"☆".repeat(5-entry.data.rating.flavor)}</span>
           </div>
           <div class="flex flex-col">
             <span class="text-[10px] uppercase opacity-50 font-bold">Body</span>
             <span class="font-mono text-sm">{"★".repeat(entry.data.rating.body)}{"☆".repeat(5-entry.data.rating.body)}</span>
           </div>
           <div class="flex flex-col">
             <span class="text-[10px] uppercase opacity-50 font-bold">Acidity</span>
             <span class="font-mono text-sm">{"★".repeat(entry.data.rating.acidity)}{"☆".repeat(5-entry.data.rating.acidity)}</span>
           </div>
        </div>
        
        <div class="mt-6 text-sm leading-relaxed prose prose-sm dark:prose-invert max-w-none pb-4">
          <p class="text-[10px] uppercase tracking-widest opacity-50 font-bold mb-2">Tasting Notes</p>
          {entry.body}
        </div>
      </div>
    </details>
  ))}
</div>

<style>
  summary::-webkit-details-marker {
    display: none;
  }
  summary {
    list-style: none;
  }
</style>