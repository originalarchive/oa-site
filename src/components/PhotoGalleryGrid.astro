---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";

interface Props {
  photos: CollectionEntry<"photos">[];
}

const { photos } = Astro.props;
---

<div class="grid grid-cols-2 md:grid-cols-3 gap-3">
  {photos.map((photo) => {
    // 1. Logic for cleaning the slug (internal)
    const cleanSlug = photo.slug.split('/')[0];
    
    // 2. Determine if external based on the data field
    const isExternal = photo.data.type === "external";
    
    // 3. Logic for the URL: uses externalUrl if it exists, otherwise internal slug
    const url = isExternal 
      ? photo.data.externalUrl 
      : `/photos/${cleanSlug}`;

    // 4. Logic for tab behavior: external opens in new tab
    const target = isExternal ? "_blank" : "_self";

    return (
      <a 
        href={url || "#"} 
        target={target}
        rel={isExternal ? "noopener noreferrer" : ""}
        class="group relative aspect-square overflow-hidden rounded-xl bg-stone-200 dark:bg-stone-800 transition-all duration-300 hover:shadow-lg"
      >
        <Image 
          src={photo.data.thumbnail} 
          alt={photo.data.title} 
          class="object-cover w-full h-full transition-transform duration-500 group-hover:scale-105"
        />
        
        <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-3">
          <div class="flex flex-col translate-y-2 group-hover:translate-y-0 transition-transform duration-300">
            <p class="text-white text-xs font-medium">
              {photo.data.title}
            </p>
            
            {photo.data.date && (
              <span class="text-white/70 text-[10px] uppercase tracking-wider mt-0.5">
                {new Date(photo.data.date).toLocaleDateString("en-US", { year: 'numeric' })}
              </span>
            )}
          </div>
        </div>
      </a>
    );
  })}
</div>