---
import { Image } from 'astro:assets';
const { folderPath, images, reverse = false } = Astro.props;

const allImages = import.meta.glob<{ default: ImageMetadata }>('/src/content/**/*.{png,jpg,jpeg,webp}', { eager: true });

// FIX 1 & 2: Added ': string' and ': any' to satisfy the TypeScript compiler
const galleryImages = images.map((name: string) => {
  const match = Object.keys(allImages).find((key) => key.includes(folderPath) && key.includes(name));
  return match ? allImages[match].default : null;
}).filter((img: any): img is ImageMetadata => img !== null);
---

<section class={`editorial-frame ${reverse ? 'flex-row-reverse is-reversed' : ''}`}>
  <div class="editorial-text-col">
    <div class="prose prose-sm dark:prose-invert custom-scrollbar">
       <slot />
    </div>
  </div>

  <div class="editorial-image-col">
    <a href="/articles" class="back-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
      Back to Articles
    </a>

    <div class="swiper editorial-swiper group">
      <div class="swiper-wrapper">
        {galleryImages.map((img: any) => (
          <div class="swiper-slide">
            <a href={img.src} class="glightbox">
              <Image 
                src={img} 
                alt="Feature visual" 
                class="editorial-img"
                loading="eager"
              />
            </a>
          </div>
        ))}
      </div>
      
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
      <div class="swiper-pagination"></div>
    </div>
    
    <div class="editorial-caption">
  <slot name="caption" />
</div>
    
  </div>
</section>

<style>
  /* 1. THE TITLE KILLER */
  .feature-breakout > h1:first-of-type,
  .feature-breakout > header:first-of-type { 
    display: none !important; 
  }

  /* 2. THE SNAP TRACK */
  html {
    scroll-snap-type: y mandatory;
    scroll-behavior: smooth;
  }

  @media (min-width: 1024px) {
    .editorial-frame {
      min-height: 100vh !important;
      margin: 0 auto !important;
      display: flex !important;
      align-items: flex-start !important; 
      scroll-snap-align: center;
      position: relative;
      overflow: visible !important; 
    }
    
    /* ADD THIS to your @media (min-width: 1024px) section */
.editorial-caption {
  margin-top: 0.1rem;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: #777; /* Subtle grey to not distract from content */
  font-weight: 600;
  text-align: center;
  width: 400px; /* Matches your swiper width to keep it aligned */
}

/* Ensure the image column doesn't squeeze the caption */
.editorial-image-col {
  display: flex !important;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}

    .editorial-frame::after {
      content: "";
      position: absolute;
      left: 55%;
      top: 140px; 
      height: 70vh; 
      width: 1px;
      background: rgba(255, 255, 255, 0.1);
      z-index: 1;
      pointer-events: none;
    }

    .is-reversed::after { left: 45%; }

    .editorial-text-col {
      flex: 0 0 55%;
      padding: 120px 4rem 100px 0; 
      display: flex;
      flex-direction: column;
    }

    .is-reversed .editorial-text-col {
      padding: 120px 0 100px 4rem;
    }

    .editorial-image-col {
      flex: 1;
      position: relative;
      display: flex !important;
      flex-direction: column;
      align-items: center;
      padding-top: 170px; 
      padding-bottom: 0px;
      overflow: visible !important;
    }

.back-link {
  align-self: flex-start;
  margin-left: 4rem;
  margin-bottom: -20px; /* Keeping your negative margin to stay tight to image */
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: #777;
  text-decoration: none;
  z-index: 50;
  
  /* ANIMATION BASE */
  transition: all 0.3s ease; /* Smoothly animates color and transform */
}


    .back-link:hover { color: #fff; }
    .is-reversed .back-link { margin-left: 0; margin-right: 4rem; align-self: flex-end; }

.back-link svg {
  transition: transform 0.3s ease; /* Specifically for the arrow move */
}

.back-link:hover {
  color: #fff;
}

/* THE "NUDGE" ANIMATION */
.back-link:hover svg {
  transform: translateX(-5px); /* Moves the arrow left on hover */
}

    .editorial-swiper {
      height: 500px !important; 
      width: 400px !important;
      border-radius: 2rem !important; 
      overflow: hidden !important; 
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
      z-index: 10;
      position: relative !important;
    }

    .editorial-img {
      width: 100% !important;
      height: 100% !important;
      object-fit: cover;
      border-radius: 2rem !important;
    }

    /* THE FIX: Restore Switchers with Pointer Priority */
    .swiper-button-next, .swiper-button-prev {
      color: #ffffff !important;
      background: rgba(0, 0, 0, 0.3) !important;
      backdrop-filter: blur(8px) !important;
      width: 44px !important;
      height: 44px !important;
      border-radius: 50% !important;
      z-index: 100 !important; /* Above the Glightbox link */
      top: 50% !important;
      transform: translateY(-50%) !important;
      opacity: 0 !important;
      transition: all 0.3s ease !important;
      pointer-events: auto !important; /* Ensure they are clickable over the link */
    }

    .editorial-swiper:hover .swiper-button-next,
    .editorial-swiper:hover .swiper-button-prev {
      opacity: 1 !important;
    }

    .swiper-button-next::after, .swiper-button-prev::after {
      font-size: 18px !important;
      font-weight: bold !important;
    }

    .swiper-button-next { right: 15px !important; }
    .swiper-button-prev { left: 15px !important; }
    
    .swiper-pagination-bullet-active {
      background: #fff !important;
    }
  }

  .custom-scrollbar::-webkit-scrollbar { width: 2px; }
  .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(100,100,100,0.3); }
</style>